{% extends "geoflow_ops/base_tenant.html" %}
{% load acl_tags %}

{% block title %}구성원 상세{% endblock %}

{% block content %}
<div class="container-fluid px-4">
  <div class="d-flex align-items-center justify-content-between mb-3">
    <h1 class="h3 mb-0">구성원 상세</h1>
    <div>
      {% if pending_request %}
        <span class="badge text-bg-warning align-middle me-2">권한 요청중</span>
        <button class="btn btn-outline-secondary btn-sm" disabled>대기중</button>
      {% else %}
        <a class="btn btn-outline-primary btn-sm" href="{% url 'tenant:employees_request_role' profile.id %}">
          권한 요청
        </a>
      {% endif %}

      <a href="{% url 'tenant:employees_list' %}" class="btn btn-outline-secondary btn-sm">목록</a>
    </div>
  </div>

  <div class="card">
    <div class="card-body">
      <div class="row g-4">
        <div class="col-md-4">
          <div class="d-flex align-items-center gap-3">
            <img src="https://api.dicebear.com/7.x/initials/svg?seed={{ profile.email|urlencode }}" width="64" height="64" class="rounded-circle" alt="">
            <div>
              <div class="fw-bold mb-1">{{ profile.name|default:"(이름 없음)" }}</div>
              <div class="text-muted small">{{ profile.email }}</div>
              <div>
                {% if profile.status == 'active' %}
                  <span class="badge bg-success">활성</span>
                {% else %}
                  <span class="badge bg-secondary">중지</span>
                {% endif %}
              </div>
            </div>
          </div>
        </div>

        <div class="col-md-8">
          <div class="row">
            <div class="col-6 mb-3">
              <div class="text-muted small">직함</div>
              <div>{{ profile.title|default:"-" }}</div>
            </div>
            <div class="col-6 mb-3">
              <div class="text-muted small">전화</div>
              <div>{{ profile.phone|default:"-" }}</div>
            </div>
            <div class="col-6 mb-3">
              <div class="text-muted small">입사일</div>
              <div>{{ profile.hire_date|date:"Y-m-d"|default:"-" }}</div>
            </div>
          </div>
        </div>
      </div>

      {% has_perm 'people.manage' as can_manage %}
      {% if can_manage %}
      <hr>
      <form method="post" action="">
        {% csrf_token %}
        <div class="row g-3">
          <div class="col-md-4">
            <label class="form-label">이름</label>
            <input type="text" name="name" value="{{ profile.name }}" class="form-control">
          </div>
          <div class="col-md-4">
            <label class="form-label">전화</label>
            <input type="text" name="phone" value="{{ profile.phone }}" class="form-control">
          </div>
          <div class="col-md-4">
            <label class="form-label">직함</label>
            <input type="text" name="title" value="{{ profile.title }}" class="form-control">
          </div>
          <div class="col-md-4">
            <label class="form-label">입사일</label>
            <input type="date" name="hire_date" value="{{ profile.hire_date|date:'Y-m-d' }}" class="form-control">
          </div>
        </div>
        <div class="mt-3">
          <button class="btn btn-primary btn-sm">저장</button>
        </div>
      </form>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}
