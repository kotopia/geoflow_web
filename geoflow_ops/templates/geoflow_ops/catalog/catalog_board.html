{# geoflow_ops/templates/geoflow_ops/catalog/catalog_board.html #}
{% extends "geoflow_ops/base_tenant.html" %}

{% block content %}
<h1 class="h3 mb-3">카테고리 설정</h1>

<div class="row">
  <!-- 왼쪽: L1 리스트 -->
  <div class="col-3">
    <div class="card">
      <div class="card-header">
        <h5 class="card-title mb-0">대분류 (L1)</h5>
      </div>
      <div class="list-group list-group-flush">
        {% for n in l1_list %}
          <a
            class="list-group-item list-group-item-action {% if current_l1 and current_l1.id == n.id %}active{% endif %}"
            href="?l1={{ n.id }}{% if project_id %}&project_id={{ project_id }}{% endif %}"
          >
            <div class="fw-bold">{{ n.name }}</div>
            <small class="text-muted">{{ n.code }}</small>
          </a>
        {% empty %}
          <div class="list-group-item">
            정의된 L1 카테고리가 없습니다.
          </div>
        {% endfor %}
      </div>
    </div>
  </div>

  <!-- 오른쪽: L2 + 옵션 보드 -->
  <div class="col-9">
    {% if current_l1 and panel %}
      <div class="card">
        <div class="card-header d-flex justify-content-between align-items-center">
          <div>
            <h5 class="card-title mb-0">
              중분류 (L2) & 옵션<br>
              <small class="text-muted">L1: {{ current_l1.name }} ({{ current_l1.code }})</small>
            </h5>
          </div>
        </div>
        <div class="card-body">
          <table class="table table-sm align-middle">
            <thead>
              <tr>
                <th style="width: 60px;">사용</th>
                <th style="width: 160px;">L2 코드</th>
                <th>L2 이름</th>
                <th style="width: 30%;">Lv3 옵션</th>
                <th style="width: 30%;">Lv4 옵션</th>
              </tr>
            </thead>
            <tbody>
            {% for row in panel.l2 %}
              <tr>
                <td>
                  <div class="form-check form-switch">
                    <input
                      class="form-check-input js-l2-toggle"
                      type="checkbox"
                      data-l2-id="{{ row.node.id }}"
                      {% if row.selected %}checked{% endif %}
                    >
                  </div>
                </td>
                <td>{{ row.node.code }}</td>
                <td>{{ row.node.name }}</td>
                <td>
                  {% for opt in row.options.3 %}
                    <span class="badge bg-light text-dark me-1 mb-1">
                      {{ opt.name }}
                    </span>
                  {% empty %}
                    <span class="text-muted">옵션 없음</span>
                  {% endfor %}
                </td>
                <td>
                  {% for opt in row.options.4 %}
                    <span class="badge bg-secondary me-1 mb-1">
                      {{ opt.name }}
                    </span>
                  {% empty %}
                    <span class="text-muted">옵션 없음</span>
                  {% endfor %}
                </td>
              </tr>
            {% empty %}
              <tr>
                <td colspan="5" class="text-center text-muted py-4">
                  이 L1에 연결된 L2가 없습니다.
                </td>
              </tr>
            {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    {% else %}
      <div class="alert alert-info">
        사용할 L1을 선택하거나, 중앙에서 카탈로그를 먼저 정의해 주세요.
      </div>
    {% endif %}
  </div>
</div>
{% endblock %}
